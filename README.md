# D&D Mass Combat Simulation

Это симуляция масштабных битв на базе правил [Dungeons & Dragons 5e SRD](https://www.dandwiki.com/wiki/5e_SRD:System_Reference_Document).

## Как это выглядит

Вот, для примера, бой [сотни легионеров](/video/legionary-vs-hoplites.mp4) против такой же сотни карфагенских гоплитов. Атаки и манёвры, удержание строя, помощь раненым, бегство слабых духом, рукопашные приёмы в поредевшем строю.

![Битва при Заме](/images/legio-vs-cartagos-goplites-Zama2.jpg)

## Что уже сделано

![Няши vs злодеи](/images/battle-3.png)  

- Реализация правил D&D 5e — практически полная.
- Все базовые классы героев — готовы до 5 уровня.
- В коде исполнены 30+ основных заклинаний. ИИ использует их в бою.
- Бойцы ориентируются на поле боя, подчиняются приказам, держат строй.
- Ввод карт в псевдографике, как в рогаликах. Легко создавать, легко править.
- Оружие и броня, карточки бойцов, заклинания, всё это в словарях питона.
- Созданные отряды можно сохранять в базе данных и снова бросать в бой.
- И да, верховые лошадки есть. Правда есть. Притом многотайловые.

Итак, возможности безграничны. Сражение армий с сотнями и тысячами солдат, осады городов, штурмы и абордажи, зачистка нежити фалангой, колдуны и драконы. Эта штука не игрушка в себе, а помощник мастера, игроки которого таки переросли чистку подземелий и теперь желают вести легионы в бой.

Испытание и доработка идёт в ходе компании «[Народы моря](https://github.com/Shadybloom/sea-tribes)», где мы пытаемся совместить битвы в стиле «Total War» и классическую героику Dungeons & Dragons.

## Как установить и запустить

Тестировалось только на GNU/Linux (но так-то должны работать везде).  
`git clone https://github.com/Shadybloom/dnd-mass-combat-simulation`  
Нужен питон третьей версии, например Python 3.7, а также sqlite3.  
`sudo apt-get update && sudo apt-get install python3.7 sqlite3`  
Кроме того понадобятся внешние библиотеки Python (можно установить в каталог пользователя):  
`pip install --user pathfinding`  

Модуль pathfinding, это AStarFinder, алгоритм поиска пути, с помощью которого солдаты ориентируются на пересечённой местности.

## Как этим пользоваться

Запустить можно из любого каталога:  
`./battle_simulation.py --help`

![Пример запуска](/images/simulation.png)

Если запустить без параметров, там будет сначала выбор карты, а затем зон спавна и отрядов. Зоны 0-4 это зелёные BLUEFOR, а зоны 5-9 красные OPFOR. Сторона конфликта задаётся выбором зоны спавна.  

А вот пример карты, где совместно воюют отряды героев и простая пехота:  
`./battle_simulation.py -r 30 -R -m battle_map_hero_mix zone_0 hero zone_1 regular zone_5 hero zone_6 regular`

В данном примере `r 30` это число раундов боя, `-R` разрешает подкрепления (если кому-то не хватит места на карте), а карты из `-m` лежат в словарях [/data/maps.py](/data/maps.py). Отряды выбираются по части слова из их названия, так что можно указать конкретнее:  
`./battle_simulation.py -r 10 -R -m battle_map_hero_mix zone_0 'Squad-hero (barbarians)' zone_1 thracian zone_5 'Squad-hero (clerics-light)' zone_6 legio`

Можно создать отряд и сохранить его в базе данных:  
`./squad_generation.py -s barbarians`

Когда снова запустите симуляцию, там появится надпись вроде:  
`Database : ['Oni Rusus Gern']`

Просто введите это название (или его часть) как название отряда. И бросьте их в бой:  
`./battle_simulation.py -r 10 -R -m battle_map_near zone_0 'Oni Rusus Gern' zone_5 spearmans`

Сколько боёв они смогут выдержать? Сколько гоблинов-в-секунду убьют? Ключ `-s` будет сохранять отряд в БД со всеми ранениями, потерями и растраченными боеприпасами, чтобы снова бросить их в бой:  
`./battle_simulation.py -r 10 -R -s -m battle_map_near zone_0 'Oni Rusus Gern' zone_5 goblins`


TODO: напиши об управлении отрядами.
